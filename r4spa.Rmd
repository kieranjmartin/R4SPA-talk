---
title: "R4SPA: R Packages and Training to enable Statistical Programming in R"
author: "Kieran Martin"
date: "2018/08/16"
output:
  xaringan::moon_reader:
    css: ["./libs/remark-css/default.css","./libs/remark-css/metropolis.css", "./libs/remark-css/metropolis-fonts.css" ]
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

layout: true

background-image: url("https://github.com/kieranjmartin/R4SPA-talk/raw/master/r4spa_files/images/rochelogo.png")

background-position: right top

background-size: auto
z-index: 1


---

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
```

# Outline

- Who are we?
- What was the problem?
- How did we solve it?
  - diffdf
  - Tailored R training
  - Some other efforts in the background

---

# Who are we?

- This work today is a collaboration between two people:
  - Kieran Martin and Craig Gower
  - check out https://github.com/gowerc and https://github.com/kieranjmartin
  - My twitter is @kjmartinstats
- We are Data Analytic Specialists
- New function, part of statistical programming
- Want to modernise statistical programming and new ways of addressing new challenges

---

# What was the problem?

Statistical Programmers want to use R!

- Lots of attendance on R training courses
- Lots of engagement in discussion around R

But very little... actual R outputs!

---

# What was the problem?

Lack of use cases for R

Key piece of Programming work is setting up analysis datasets

Reluctance to use R for his task?

Why?

---

# Why?

Belief that data manipulation in R is difficult

Lack of tools (proc compare)

Unclear how to work in production

---

# What we are doing

- diffdf
- R training
- helper packages

---

#diffdf

Package for comparing datasets

Main page: https://gowerc.github.io/diffdf/

Now on CRAN: https://cran.r-project.org/web/packages/diffdf/index.html

Check out github: https://github.com/gowerc/diffdf

---
# diffdf example of use:
```{r, include = FALSE}

LENGTH = 30
set.seed(12334)
test_data <- tibble::tibble( 
    ID          = 1:LENGTH,
    GROUP1      = rep( c(1,2) , each = LENGTH/2),
    GROUP2      = rep( c(1:(LENGTH/2)), 2 ),
    INTEGER     = rpois(LENGTH , 40),
    BINARY      = sample( c("M" , "F") , LENGTH , replace = T),
    DATE        = lubridate::ymd("2000-01-01") + rnorm(LENGTH, 0, 7000),
    DATETIME    = lubridate::ymd_hms("2000-01-01 00:00:00") + rnorm(LENGTH, 0, 200000000), 
    CONTINUOUS  = rnorm(LENGTH , 30 , 12),
    CATEGORICAL = factor(sample( c("A" , "B" , "C") , LENGTH , replace = T)),
    LOGICAL     = sample( c(TRUE , FALSE) , LENGTH , replace = T),
    CHARACTER   = stringi::stri_rand_strings(LENGTH,  rpois(LENGTH , 13),  pattern = "[ A-Za-z0-9]")
)
```


```{r}
library(diffdf)
test_data
```


---
# diffdf: missing columns:
```{r}
diffdf( test_data , test_data)
```
```{r}
test_data2 <- test_data 
test_data2 <- test_data2[,-6]
diffdf(test_data , test_data2 , suppress_warnings = T)
```
---
# diffdf: missing rows
```{r}
test_data2 <- test_data
test_data2 <- test_data2[1:(nrow(test_data2) - 2),]
diffdf(test_data, test_data2 , suppress_warnings = T)
```
---
# diffdf: different values
```{r}
test_data2 <- test_data
test_data2[5,2] <- 6
difval <- diffdf(test_data , test_data2 , suppress_warnings = T)
difval$NumDiff
difval$VarDiff_GROUP1
```
---
# diffdf: different attributes
```{r}
test_data2 <- test_data
attr(test_data$ID , "label") <- "This is a interesting label"
attr(test_data2$ID , "label") <- "what do I type here?"
diffdf(test_data , test_data2 , suppress_warnings = T)
```
---

# diffdf: specify id variables
```{r}
test_data2 <- test_data
test_data2$INTEGER[c(5,2,15)] <- 99L 
iddiff <- diffdf( test_data , test_data2 , keys = c("GROUP1" , "GROUP2") ,
        suppress_warnings = T)
iddiff$NumDiff
iddiff$VarDiff_INTEGER
```

---
# R training 

In house training on data manipulation using the tidyverse

**What makes this different?**

- Focused on one task: data derivation
- tidyverse makes easier to read code (easier for those with less R experience)
- Exercises based on our data and specifications
- Plan to train people before they have a specific use case for the training

# Other activities / Q and A

- Other helper packages
  - Goal to make people's lives easier when working in R
- Any questions?

